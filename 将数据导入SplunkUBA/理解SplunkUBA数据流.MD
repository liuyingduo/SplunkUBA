# 理解Splunk UBA中的数据流

Splunk UBA的整个数据流向如下图所示：
![图示](https://docs.splunk.com/images/thumb/4/4f/UBA_Data_Flow_v5.png/1050px-UBA_Data_Flow_v5.png)

|步骤|过程|描述|
|----|----|----|
|1|来自splunk平台的原始数据和已解析的数据|splunk UBA可以提取解析符合[CIM(Common Information Model)](https://docs.splunk.com/Documentation/Splunk/8.1.1/Knowledge/UnderstandandusetheCommonInformationModel)的数据或原始数据。你必须选择合适的连接器(connector)类型。使用**Splunk Direct**连接器在splunk上面解析数据之后再进入Splunk UBA。使用**Splunk Raw Events**连接器使用Splunk UBA本地的解析器来解析数据。 |
|2|账户规范化和身份解析|Splunk UBA分析来自Splunk的数据，并将数据中的字段映射到UBA中的特定字段，正确映射的数据字段可以使Splunk UBA能够执行如下操作：1、规范化设备和域名，并将其HR数据中标识的所有帐户与单个人工账户相关联。2、执行身份解析以查找IP地址，主机名和用户之间的实时关联，并随着时间的推移保持这些关联|
|3|特定于每种数据类型的视图|Splunk UBA将数据进行一定程度上的抽象，以使你可以看到重要的，相关的数据。例如，防火墙日志由于不同厂商来源具有多种日志格式。Splunk UBA抽象了相关数据的不同，只提取了防火墙相关活动的数据，例如IP，端口，和防火墙动作行为信息。这种元数据以适当的视图进行标记，如**防火墙**，并且存储在数据体(一个数据体类似于一张excel表格)中。你也可以配置一般的数据源将原始数据直接传递到Splunk UBA中。这些原始数据属于一般的视图，并且也被存储在数据体中，也被用于异常处理过程。|
|4|异常模型|异常模型分析Splunk UBA中的数据(此时的数据格式一般为数据体)，并基于多种因素创建异常值 1、流式模型实时分析提取的数据，并确定这些数据在短时间内(如过去一小时)的影响。基于这种分析，流式模型可以在Splunk UBA中产生大量的项目，例如异常，失陷指标(IOCs),或分析数据 2、批处理模型和异常规则分析在较大的时间窗口(如过去24小时)内传入的数据，因为需要处理大量数据所以通常在夜晚运行。Splunk UBA中的所有威胁模型都是批处理模型，考虑到包括流处理命令编录数据与数据聚合。Splunk UBA有两种类型的批处理模型：(1)、罕见异常模型通过检测不寻常的，罕见的，首次活动来生成异常。(2)、时间序列模型通过跟踪一段时期之内的特定活动来产生异常。 你可以创建新的批处理异常模型，或者使用自定义的用例框架克隆存在的模型。请看[什么是自定义用例框架](http://docs.splunk.com/Documentation/UBA/5.0.4/Custom/CustomOverview)在*开发自定义内容*中。   异常被分组为各种类别，例如泄露，感染，扩大。这些类别通常对应于Kill Chain的各个阶段，使得威胁逻辑可以把异常放入Chain中正确部分。异常模型也向异常中添加元数据。这些元数据特定于单个异常类型，并用于在调查或异常捕获筛选异常。|
|5|||
